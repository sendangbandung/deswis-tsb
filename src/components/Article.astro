---
import Section from './Section.astro';
import ObjectItem from './ObjectItem.astro';
import hero from '../assets/hero.jpg';
import { artikel } from '../data/konfigurasi.js';

const rawPosts = Object.values(import.meta.glob('../data/articles/*.md', { eager: true }));

const allPosts = rawPosts.map((post) => {
	const {file, frontmatter} = post;
	const articleSlug = frontmatter.slug || file.split('/').pop().replace('.md', '');
	return {
		title: frontmatter.title,
		description: frontmatter.description,
		link: `/articles/${articleSlug}`,
		thumbnail: frontmatter.thumbnail || hero.src,
		date: frontmatter.date,
		author: frontmatter.author || 'Admin',
		draft: frontmatter.draft || false,
	}
});

const filteredPosts = allPosts.filter(post => {
	return !post.draft;
});
const sortedPosts = filteredPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
---
<Section id="artikel" className="bg-white">
	<div class="flex flex-col items-center w-full text-center">
	<h2 class="text-3xl md:text-4xl font-bold">{artikel.title}</h2>
		<p class="mt-4 max-w-2xl text-lg text-gray-600">
			{artikel.subtitle}
		</p>
		
		<div class="w-full mt-12 relative group/article px-4 md:px-12">
			<button 
				id="article-prev"
				class="absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 hover:bg-white p-3 rounded-full shadow-lg text-gray-800 transition-all opacity-100 focus:opacity-100 translate-x-2 md:translate-x-0 active:scale-95"
				aria-label="Scroll kiri"
			>
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
					<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
				</svg>
			</button>

			<div id="article-container" class="w-full overflow-x-auto pb-4 simple-scrollbar scroll-smooth cursor-grab active:cursor-grabbing select-none">
				<div class="flex w-fit mx-auto gap-6 px-6">
					{sortedPosts.slice(0, 10).map((item) => (
						<div class="w-80 md:w-96 flex-shrink-0 h-full">
							<ObjectItem {...item} />
						</div>
					))}
				</div>
			</div>

			<button 
				id="article-next"
				class="absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 hover:bg-white p-3 rounded-full shadow-lg text-gray-800 transition-all opacity-100 focus:opacity-100 -translate-x-2 md:translate-x-0 active:scale-95"
				aria-label="Scroll kanan"
			>
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
					<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
				</svg>
			</button>
		</div>

		<div class="mt-8">
			<a href="/articles" class="btn bg-primary">
				Lihat Semua Artikel
			</a>
		</div>
	</div>
</Section>

<script>
	const container = document.getElementById('article-container');
	const prevBtn = document.getElementById('article-prev');
	const nextBtn = document.getElementById('article-next');

	if (container && prevBtn && nextBtn) {
		const scrollAmount = 400;

		prevBtn.addEventListener('click', () => {
			container.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
		});

		nextBtn.addEventListener('click', () => {
			container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
		});

		// Mouse Drag Scrolling
		let isDown = false;
		let startX;
		let scrollLeft;

		container.addEventListener('mousedown', (e) => {
			isDown = true;
			container.classList.remove('scroll-smooth');
			startX = e.pageX - container.offsetLeft;
			scrollLeft = container.scrollLeft;
		});

		container.addEventListener('mouseleave', () => {
			isDown = false;
			container.classList.add('scroll-smooth');
		});

		container.addEventListener('mouseup', () => {
			isDown = false;
			container.classList.add('scroll-smooth');
		});

		container.addEventListener('mousemove', (e) => {
			if (!isDown) return;
			e.preventDefault();
			const x = e.pageX - container.offsetLeft;
			const walk = (x - startX) * 2; 
			container.scrollLeft = scrollLeft - walk;
		});
	}
</script>

<style>
.simple-scrollbar::-webkit-scrollbar {
	height: 8px;
}
.simple-scrollbar::-webkit-scrollbar-track {
	background: #e5e7eb; /* bg-gray-200 */
	border-radius: 10px;
}
.simple-scrollbar::-webkit-scrollbar-thumb {
	background: #9ca3af; /* bg-gray-400 */
	border-radius: 10px;
}
.simple-scrollbar::-webkit-scrollbar-thumb:hover {
	background: #6b7280; /* bg-gray-500 */
}
</style>

