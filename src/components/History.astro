---
import Section from './Section.astro';
import { history } from '../data/konfigurasi.js';
import heroImg from '../assets/hero.jpg';

---
<Section id="sejarah">
	<div class="flex md:flex-row flex-col gap-8 md:gap-12 items-center">
	<h2 class="text-3xl md:text-4xl md:hidden font-bold">{history.title}</h2>
			
		<div class="w-full md:w-1/2">
			<video
				loop
				muted
				playsinline
				preload="none"
				poster={heroImg.src}
				class="lazy-video rounded-2xl shadow-xl w-full h-auto object-cover aspect-square md:aspect-auto transition-transform duration-300 hover:scale-105" 
			>
				<source src="/hero0001-0922-final.mp4" type="video/mp4" />
				Your browser does not support the video tag.
			</video>

		</div>

		<div class="w-full md:w-1/2 flex flex-col gap-4">
			<h2 class="text-3xl md:text-4xl font-bold hidden md:inline">{history.title}</h2>
				{history.description.map((paragraph) => (
					<p class="text-lg text-gray-600">
						{paragraph}
					</p>
				))}
			
			<div class="grid grid-cols-3 gap-4 text-center pt-6">
				{history.items.map((item) => (
					<div class="bg-primary/10 p-4 rounded-xl">
						<h3 class="text-2xl font-bold text-primary">{item.kuantity}</h3>
						<p class="text-sm font-medium text-gray-700">{item.kind}</p>
					</div>
				))}
			</div>
		</div>

	</div>
</Section>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const lazyVideos = document.querySelectorAll('video.lazy-video');

		if ('IntersectionObserver' in window) {
			const videoObserver = new IntersectionObserver((entries, observer) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						const video = entry.target as HTMLVideoElement;
						video.play();
						observer.unobserve(video);
					}
				});
			});

			lazyVideos.forEach((video) => {
				videoObserver.observe(video);
			});
		} else {
			// Fallback for browsers that don't support IntersectionObserver
			lazyVideos.forEach((video) => {
				(video as HTMLVideoElement).play();
			});
		}
	});
</script>